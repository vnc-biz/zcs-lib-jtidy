<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j="jelly:core" xmlns:u="jelly:util" default="rebuild-all">

    <goal name="rebuild-all">
        <j:set var="goals" value="pom,clean,ant,dist" />
        <mkdir dir="${maven.build.dir}" />
        <u:tokenize var="goals" delim=",">${goals}</u:tokenize>
        <j:forEach items="${goals}" var="goal" indexVar="goalNumber">
            Now attaining goal number ${goalNumber}, which is ${goal}
            <attainGoal name="${goal}" />
        </j:forEach>
    </goal>


    <postGoal name="dist:prepare-src-filesystem">
        <copy todir="${maven.dist.src.assembly.dir}">
            <fileset dir=".">
                <include name="checkstyle.xml" />
            </fileset>
        </copy>
    </postGoal>

    <preGoal name="site:sshdeploy">
        <mkdir dir="${maven.build.dir}/docs/maven" />
        <copy file="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}.jar"
            todir="${maven.build.dir}/docs/maven/${pom.groupId}/jars" />
    </preGoal>

    <goal name="nightly">
        <attainGoal name="rebuild-all" />
        <mkdir dir="${maven.build.dir}/docs/nightly" />
        <copy todir="${maven.build.dir}/docs/nightly">
            <fileset dir="${maven.build.dir}/distributions" />
        </copy>
        <attainGoal name="site:sshdeploy" />
    </goal>

</project>

