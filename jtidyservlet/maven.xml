<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project >
<project xmlns:j="jelly:core" xmlns:u="jelly:util" default="rebuild-all">
    <!-- default goal -->
    <goal name="rebuild-all">
        <j:set var="goals" value="pom,clean,jar:jar,dist:build" />
        <mkdir dir="${maven.build.dir}" />
        <u:tokenize var="goals" delim=",">${goals}</u:tokenize>
        <j:forEach items="${goals}" var="goal" indexVar="goalNumber"> Now attaining goal number ${goalNumber}, which is
            ${goal} <attainGoal name="${goal}" /> </j:forEach>
    </goal>
    <!-- set up tlds before test -->
    <preGoal name="test:test">
        <echo message="copying tld files to ${maven.build.dir}/test-classes/WEB-INF" />
        <copy todir="${maven.build.dir}/test-classes/WEB-INF" >
            <fileset dir="${maven.src.dir}/tld">
                <include name="*.tld"/>
            </fileset>
        </copy>
        <copy todir="${maven.build.dir}/test-classes/resources" >
            <fileset dir="${maven.src.dir}/resources">
                <include name="*.gif"/>
            </fileset>
        </copy>
    </preGoal>
    <preGoal name="jar:jar">
        <!-- generated tld should be ready before tests -->
        <!-- create 1.1 dtd -->
        <attainGoal name="taglib:convert" />
        <!-- copy tlds to build dest -->
        <echo message="copying tld files in ${maven.src.dir}/tld to ${maven.build.dir}/tld" />
        <copy todir="${maven.build.dir}/tld" >
            <fileset dir="${maven.src.dir}/tld">
                <include name="*.tld"/>
            </fileset>
        </copy>
        <!-- add tlds to taglib jar -->
        <echo message="copying tld files ${maven.build.dir}/tld to ${maven.build.dest}/META-INF" />
        <copy todir="${maven.build.dest}/META-INF" >
            <fileset dir="${maven.build.dir}/tld">
                <include name="*.tld"/>
            </fileset>
        </copy>
        <echo message="copying gif files ${maven.build.dir}/resources to ${maven.build.dest}/resources" />
        <copy todir="${maven.build.dir}/resources" >
            <fileset dir="${maven.src.dir}/resources">
                <include name="*.gif"/>
            </fileset>
        </copy>
    </preGoal>
</project>